define("linebuilder",["require","exports","module"],function(e,n){var t=e("./collections.js"),i=e("./inline.js");n.createBuilder=function(e,n){return{_outputLines:[],_generateIdsFor:["h","li","p","blockquote"],currentLine:"",options:e,scope:n,generateId:function(e){var n=!1;if(("h"==e.element||"p"==e.element||"li"==e.element)&&(n=!0),n){var t=e.remainingLine,i=100;t.length>i&&(t=t.substring(0,i));for(var o=this.formatDataKey(t),r=o,s=0;this.scope.hasUsedId(o);)s++,o=r+"-"+s.toString();return o}return void 0},applyOptions:function(n){e&&e.generateIds&&!n.id&&(n.id=this.generateId(n))},beginLine:function(){""!==this.currentLine&&this._outputLines.push(this.currentLine),this.currentLine=""},complete:function(){""!==this.currentLine&&this._outputLines.push(this.currentLine)},formatDataKey:function(e){function n(e){return 1===e.length&&e.match(/[a-z]/i)}var i="",o=e.split(""),r=!1;for(t.each(o,function(e,t){if(n(t)){var o=t.toLocaleUpperCase();o==t?r&&(t="-"+t,r=!1):r=!0}else t="-";i+=t.toLocaleLowerCase()});i.indexOf("--")>-1;)i=i.replace("--","-");return i},tagWithEnd:function(e,n,i,o,r,s){var a="<"+e;if(n&&(this.scope.hasUsedId(n)||(a=a+" id='"+n+"'",this.scope.usedId(n))),i&&(i=i.split("&"),i=i.join(" "),a=a+" class='"+i+"'"),o){var c=this;t.each(o,function(e,n){a=a+" data-"+c.formatDataKey(n.key)+"='"+n.value+"'"})}r&&(a=a+" "+r),a+=s,this.append(a)},openTag:function(e,n,t,i,o){this.tagWithEnd(e,n,t,i,o,">")},selfClosingTag:function(e,n,t,i){this.tagWithEnd(e,n,t,i,void 0,"/>")},append:function(e){this.currentLine=this.currentLine+e},closeTag:function(e){this.append("</"+e+">")},result:function(){var e="";return t.each(this._outputLines,function(n,t){n>0&&(e+="\r\n"),e+=t}),e},endScope:function(e){for(;e.hasCurrentBlock();){var n=e.popBlock();this.closeTag(n.element),this.beginLine()}},endScopeWithoutLineBreak:function(e){for(;e.hasCurrentBlock();){var n=e.popBlock();this.closeTag(n.element)}},endCurrentScope:function(e){if(e.hasCurrentBlock()){var n=e.popBlock();this.closeTag(n.element),this.beginLine()}},endCurrentScopeWithoutLineBreak:function(e){if(e.hasCurrentBlock()){var n=e.popBlock();this.closeTag(n.element)}},addInline:function(e){i.replaceInline(e,this)},writeDataBlocks:function(e){var n=this;e&&e.length>0&&(console.log("Writing data blocks"),t.each(e,function(e,t){var i=t.id,o=t.classes?t.classes.toLocaleLowerCase():"json",r="json"==o?"application/json":"jsonp"==o?"application/javascript":"xml"==o?"application/xml":"text/plain";n.beginLine(),n.openTag("script",i,void 0,void 0,"type='"+r+"'"),n.beginLine(),n.closeTag("script")}))}}}});