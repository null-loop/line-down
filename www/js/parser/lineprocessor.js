define("lineprocessor",["require","exports","module"],function(e,t){var i=(e("./collections.js"),{startsWith:e("./startswith.js").startsWith,createScope:e("./scope.js").createScope});t.processLine=function(e,t,n){n.beginLine();var s,a,l=e.trim(),r=i.createScope(),o=i.startsWith('"',l,2);if(o.startsWith)t.hasElementScope("blockquote")&&0===o.remainingLine.trim().length||(t.isImplicitParagraphScope()&&n.endCurrentScopeWithoutLineBreak(t),t.pushBlock({element:"blockquote",spec:'""'}),o.element="blockquote",n.applyOptions(o),n.openTag("blockquote",o.id,o.classes,o.dataPairs),l=o.remainingLine,a=!0);else{var p=i.startsWith("'",l,2);if(p.startsWith)t.hasElementScope("p")&&0===p.remainingLine.trim().length||(t.isImplicitParagraphScope()&&n.endCurrentScopeWithoutLineBreak(t),t.pushBlock({element:"p",spec:"''"}),p.element="p",n.applyOptions(p),n.openTag("p",p.id,p.classes,p.dataPairs),l=p.remainingLine,a=!0);else{var c=i.startsWith("-",l,3);if(c.startsWith&&0===c.remainingLine.trim().length)t.isImplicitParagraphScope()&&n.endCurrentScopeWithoutLineBreak(t),c.element="hr",n.applyOptions(c),n.selfClosingTag("hr",c.id,c.classes,c.dataPairs),l=c.remainingLine,a=!0;else{var h=i.startsWith("%&",l,2);if(h.startsWith)t.hasElementScope("ul")&&0===h.remainingLine.trim().length||(t.isImplicitParagraphScope()&&n.endCurrentScopeWithoutLineBreak(t),t.pushBlock({element:"ul",spec:"%&"}),h.element="ul",n.applyOptions(h),n.openTag("ul",h.id,h.classes,h.dataPairs),l=h.remainingLine,a=!0);else{var m=i.startsWith("%+",l,2,!1,!0);if(m.startsWith)t.hasElementScope("ol")&&0===m.remainingLine.trim().length||(t.isImplicitParagraphScope()&&n.endCurrentScopeWithoutLineBreak(t),t.pushBlock({element:"ol",spec:"%+"}),m.element="ol",m.numberCapture?(n.applyOptions(m),n.openTag("ol",m.id,m.classes,m.dataPairs,"start='"+m.numberCapture+"'")):(n.applyOptions(m),n.openTag("ol",m.id,m.classes,m.dataPairs)),l=m.remainingLine,a=!0);else{var u=i.startsWith("$",l,4);u.startsWith&&(t.inDataBlock()&&0===u.remainingLine.trim().length||(t.startDataBlock(u),n.options.generateIds||(n.options.implicitGenerateIds=!0,n.options.generateIds=!0),l=u.remainingLine,a=!0))}}}}}var g=i.startsWith("#",l);if(g.startsWith)r.pushBlock({element:"h"+g.symbolCount}),g.element="h",n.applyOptions(g),n.openTag("h"+g.symbolCount,g.id,g.classes,g.dataPairs),l=g.remainingLine,s=!0;else{var d=i.startsWith("+",l);d.startsWith&&0!==d.remainingLine.trim().length?(t.hasElementScope("ol")||(t.pushBlock({element:"ol",spec:"++",implicit:!0}),n.openTag("ol")),r.pushBlock({element:"li"}),d.element="li",n.applyOptions(d),n.openTag("li",d.id,d.classes,d.dataPairs),l=d.remainingLine,s=!0):(d=i.startsWith("&",l),d.startsWith&&0!==d.remainingLine.trim().length&&(t.hasElementScope("ul")||(t.pushBlock({element:"ul",spec:"&&",implicit:!0}),n.openTag("ul")),r.pushBlock({element:"li"}),d.element="li",n.applyOptions(d),n.openTag("li",d.id,d.classes,d.dataPairs),l=d.remainingLine,s=!0))}if(!s&&!a&&0===l.length)for(;t.hasCurrentBlock()&&"blockquote"!=t.currentBlockElement();)n.endCurrentScope(t);var k,B=!1;if(l.length>1){var S,W=l.substring(l.length-2,l.length);if("''"==W&&t.hasElementScope("p"))k="p",S=2;else if('""'==W&&t.hasElementScope("blockquote"))k="blockquote",S=2;else if("%&"==W&&t.hasElementScope("ul"))k="ul",S=2;else if("%+"==W&&t.hasElementScope("ol"))k="ol",S=2;else if(l.length>3){var L=l.substring(l.length-4,l.length);"$$$$"==L&&t.inDataBlock()&&(n.options.implicitGenerateIds&&(n.options.generateIds=!1),t.finishDataBlock(),l=l.substring(0,l.length-4).trim())}k&&(l=l.substring(0,l.length-S).trim())}if(r.hasCurrentBlock()||t.hasCurrentBlock()&&"blockquote"!=t.currentBlockElement()||!(l.length>0)||(t.pushBlock({element:"p",spec:"''",implicit:!0}),n.openTag("p")),k){for(B=!0,n.addInline(l),n.endScopeWithoutLineBreak(r);t.hasCurrentBlock()&&t.currentBlockElement()!=k;)n.endCurrentScopeWithoutLineBreak(t);n.endCurrentScopeWithoutLineBreak(t)}B||(n.addInline(l),n.endScope(r))}});